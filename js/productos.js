// productos.js
// Lista de perfumes Clemenss para mostrar en productos.html

window.productos = [
  {
    nombre: "La Vie Est Belle",
    precio: 500000,
    imagen: "images/product-thumb-1.png",
    categoria: "Para ella",
    descuento: "10% OFF",
    precioOriginal: 350000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Una fragancia femenina, dulce y sofisticada, con notas de iris, jazmín y flor de azahar. Ideal para mujeres que buscan elegancia y alegría en cada aroma."
  },
  {
    nombre: "Flowerbomb",
    precio: 230000,
    imagen: "images/product-thumb-2.png",
    categoria: "Para ella",
    descuento: "10% OFF",
    precioOriginal: 330000,
    rating: 4.5,
    reviews: 41,
    descripcion: "Explosión floral con matices de té y bergamota, envolvente y moderno. Perfecto para mujeres que desean destacar con un aroma vibrante y femenino."
  },
  {
    nombre: "Chanel No 5",
    precio: 450000,
    imagen: "images/product-thumb-3.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 600000,
    rating: 4.5,
    reviews: 32,
    descripcion: "El clásico eterno de Chanel, con notas de jazmín, rosa y aldehídos. Elegancia y sofisticación en cada gota, símbolo de la feminidad atemporal."
  },
  {
    nombre: "Good Girl",
    precio: 420000,
    imagen: "images/product-thumb-4.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 540000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Una fragancia audaz y sensual, con notas de almendra, café y cacao. Para mujeres modernas y seguras que disfrutan de la dualidad entre lo dulce y lo intenso."
  },
  {
    nombre: "Black Opium",
    precio: 340000,
    imagen: "images/product-thumb-5.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 460000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Aroma oriental y vibrante, con café, vainilla y flores blancas. Perfecto para noches especiales y mujeres que buscan un toque misterioso."
  },
  {
    nombre: "J'adore",
    precio: 480000,
    imagen: "images/product-thumb-6.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 620000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Fragancia floral y luminosa, con notas de ylang-ylang, rosa y jazmín. Refleja la feminidad y el lujo en cada aplicación."
  },
  {
    nombre: "Sì (Giorgio Armani)",
    precio: 380000,
    imagen: "images/product-thumb-7.png",
    categoria: "Para ella",
    descuento: "10% OFF",
    precioOriginal: 480000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Notas de grosella negra, rosa y vainilla. Un perfume elegante y moderno para mujeres independientes y sofisticadas."
  },
  {
    nombre: "Alien (Mugler)",
    precio: 350000,
    imagen: "images/product-thumb-8.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 460000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Fragancia misteriosa y envolvente, con jazmín sambac y ámbar blanco. Ideal para quienes buscan un aroma único y fuera de lo común."
  },
  {
    nombre: "Portrait of a Lady",
    precio: 400000,
    imagen: "images/product-thumb-9.png",
    categoria: "Para ella",
    descuento: "17% OFF",
    precioOriginal: 620000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Rosa, especias y pachulí en una fragancia intensa y sofisticada. Para mujeres que buscan elegancia y carácter."
  },
  {
    nombre: "Parfums de Marly Valaya",
    precio: 390000,
    imagen: "images/product-thumb-10.png",
    categoria: "Para ella",
    descuento: "15% OFF",
    precioOriginal: 490000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Aroma fresco y floral, con notas de almizcle y flores blancas. Ideal para quienes buscan delicadeza y modernidad."
  },
  {
    nombre: "Le Male Elixir",
    precio: 400000,
    imagen: "images/perfume_232x210.png",
    categoria: "Para él",
    descuento: "10% OFF",
    precioOriginal: 500000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Aroma masculino y seductor, con notas de lavanda, menta y vainilla. Para hombres que buscan destacar con personalidad y frescura."
  },
  {
    nombre: "bleu de chanel",
    precio: 450000,
    imagen: "images/product-thumb-11.png",
    categoria: "Para él",
    descuento: "15% OFF",
    precioOriginal: 650000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Fragancia fresca y amaderada, con notas de cítricos y sándalo. Elegancia y libertad para el hombre moderno."
  },
  {
    nombre: "One Millon",
    precio: 480000,
    imagen: "images/product-thumb-12.png",
    categoria: "Para él",
    descuento: "20% OFF",
    precioOriginal: 680000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Aroma intenso y especiado, con mandarina, canela y cuero. Para hombres audaces y con espíritu ganador."
  },
  {
    nombre: "Dior Sauvage",
    precio: 370000,
    imagen: "images/product-thumb-13.png",
    categoria: "Para él",
    descuento: "15% OFF",
    precioOriginal: 480000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Fragancia fresca y salvaje, con bergamota y ambroxan. Inspirada en la naturaleza y la libertad masculina."
  },
  {
    nombre: "Creed Aventus",
    precio: 450000,
    imagen: "images/product-thumb-14.png",
    categoria: "Para él",
    descuento: "15% OFF",
    precioOriginal: 650000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Perfume sofisticado y potente, con piña, musgo y madera. Para líderes y hombres de éxito."
  },
  {
    nombre: "Acqua Di Gio Parfum",
    precio: 400000,
    imagen: "images/product-thumb-15.png",
    categoria: "Para él",
    descuento: "15% OFF",
    precioOriginal: 600000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Aroma marino y fresco, con notas de bergamota y pachulí. Perfecto para el hombre activo y elegante."
  },
  {
    nombre: "Le Labo Santal 33",
    precio: 450000,
    imagen: "images/product-thumb-16.png",
    categoria: "Para él",
    descuento: "19% OFF",
    precioOriginal: 650000,
    rating: 4.5,
    reviews: 222,
    descripcion: "Fragancia unisex, amaderada y especiada, con sándalo y cardamomo. Para quienes buscan un aroma distintivo y moderno."
  },
  {
    nombre: "Afnan 9pm",
    precio: 320000,
    imagen: "images/product-thumb-17.png",
    categoria: "Para él",
    descuento: "12% OFF",
    precioOriginal: 365000,
    rating: 4.5,
    reviews: 180,
    descripcion: "Aroma oriental y dulce, con notas de manzana, lavanda y vainilla. Ideal para noches especiales y hombres modernos."
  },
  {
    nombre: "Boss",
    precio: 390000,
    imagen: "images/product-thumb-18.png",
    categoria: "Para él",
    descuento: "10% OFF",
    precioOriginal: 430000,
    rating: 4.5,
    reviews: 210,
    descripcion: "Fragancia fresca y elegante, con notas de manzana, canela y sándalo. Para hombres seguros y sofisticados."
  },
  {
    nombre: "Eau De Cedrat",
    precio: 310000,
    imagen: "images/product-thumb-181.png",
    categoria: "Para él",
    descuento: "15% OFF",
    precioOriginal: 365000,
    rating: 4.5,
    reviews: 95,
    descripcion: "Aroma cítrico y vibrante, con notas de cedro y menta. Perfecto para el hombre activo y enérgico."
  }
];

function renderProductos() {
  const contenedor = document.getElementById('productos-lista');
  if (!contenedor) return;
  contenedor.innerHTML = '';
  if (!productos || productos.length === 0) {
    contenedor.innerHTML = '<div class="col"><div class="alert alert-warning text-center">No hay productos para mostrar.</div></div>';
    return;
  }
  productos.forEach((producto, idx) => {
    const card = document.createElement('div');
    card.className = 'col';
    card.innerHTML = `
      <div class="product-item card h-100 p-3">
        <figure class="text-center">
          <img src="${producto.imagen}" alt="${producto.nombre}" class="tab-image" style="max-width:100%;height:auto;">
        </figure>
        <div class="d-flex flex-column text-center">
          <h3 class="fs-6 fw-normal">${producto.nombre}</h3>
          <div class="mb-2">
            <span class="rating">
              ${'<svg width="18" height="18" class="text-warning"><use xlink:href="#star-full"></use></svg>'.repeat(Math.floor(producto.rating))}
              <svg width="18" height="18" class="text-warning"><use xlink:href="#star-half"></use></svg>
            </span>
            <span>(${producto.reviews})</span>
          </div>
          <div class="d-flex justify-content-center align-items-center gap-2 mb-2">
            <del>$${producto.precioOriginal.toLocaleString()}</del>
            <span class="text-dark fw-semibold">$${producto.precio.toLocaleString()}</span>
            <span class="badge border border-dark-subtle rounded-0 fw-normal px-1 fs-7 lh-1 text-body-tertiary">${producto.descuento}</span>
          </div>
          <div class="button-area p-3 pt-0">
            <div class="row g-1 mt-2">
              <div class="col-3"><input type="number" name="quantity" class="form-control border-dark-subtle input-number quantity" value="1" id="qty-prod-${idx}"></div>
              <div class="col-7">
                <button type="button" class="btn btn-primary rounded-1 p-2 fs-7 btn-cart" id="btn-cart-${idx}" data-idx="${idx}">
                  <svg width="18" height="18"><use xlink:href='#cart'></use></svg> Add to Cart
                </button>
              </div>
              <div class="col-2"><a href="#" class="btn btn-outline-dark rounded-1 p-2 fs-6"><svg width="18" height="18"><use xlink:href='#heart'></use></svg></a></div>
            </div>
          </div>
        </div>
      </div>
    `;
    contenedor.appendChild(card);
  });

  // Asignar eventos a todos los botones después de renderizar (sin setTimeout)
  document.querySelectorAll('.btn-cart').forEach(btn => {
    btn.addEventListener('click', function(e) {
      e.preventDefault();
      if (!usuarioLogueado()) {
        alert('Debes iniciar sesión para agregar productos al carrito.');
        window.location.href = 'login.html';
        return;
      }
      const idx = this.getAttribute('data-idx');
      const cantidad = parseInt(document.getElementById(`qty-prod-${idx}`).value) || 1;
      const producto = productos[idx];
      console.log('Evento directo: Add to Cart clickeado:', producto.nombre);
      agregarAlCarrito({
        nombre: producto.nombre,
        precio: producto.precio,
        imagen: producto.imagen,
        cantidad: cantidad
      });
      // Mostrar mensaje en index.html
      const mensaje = document.getElementById('mensaje');
      if (mensaje) {
        mensaje.textContent = 'Producto agregado al carrito.';
        mensaje.style.display = 'block';
        setTimeout(() => { mensaje.style.display = 'none'; }, 2500);
      }
      // Actualizar carrito.html si está abierto
      if (window.location.pathname.includes('carrito.html')) {
        if (typeof mostrarCarrito === 'function') {
          mostrarCarrito();
        }
      }
    });
  });
  console.log('Botones Add to Cart listos y eventos asignados.');
}


function usuarioLogueado() {
  try {
    const session = localStorage.getItem('app.jwt');
    if (!session) return false;
    const obj = JSON.parse(session);
    return !!(obj && obj.user && obj.user.name);
  } catch {
    return false;
  }
}

document.addEventListener('DOMContentLoaded', renderProductos);
