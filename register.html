<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Usuario</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tu CSS -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container" style="max-width:400px;margin:40px auto;">
    <h2 class="mb-4">Crear cuenta</h2>

    <form id="registerForm" novalidate>
      <div class="mb-3">
        <label for="name" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="name" name="name" autocomplete="name" required />
        <div class="invalid-feedback">Ingresa tu nombre.</div>
      </div>

      <div class="mb-3">
        <label for="email" class="form-label">Correo electr√≥nico</label>
        <input type="email" class="form-control" id="email" name="email" autocomplete="email" required />
        <div class="invalid-feedback">Ingresa un email v√°lido.</div>
      </div>

      <div class="mb-3">
        <label for="password" class="form-label">Contrase√±a</label>
        <input type="password" class="form-control" id="password" name="password" autocomplete="new-password" minlength="6" required />
        <div class="invalid-feedback">M√≠nimo 6 caracteres.</div>
      </div>

      <div id="registerMsg" class="mb-3" role="alert" aria-live="polite" style="display:none;"></div>

      <button type="submit" class="btn btn-primary w-100">Registrarse</button>
    </form>

    <div class="mt-3 text-center">
      <a href="login.html">¬øYa tienes cuenta? Inicia sesi√≥n</a>
    </div>
  </div>

  <!-- üëá Usa SIEMPRE la URL de tu API en Render en producci√≥n -->
  <script>
    // En producci√≥n:
    const API_BASE = "https://perfumeriaclemenss.onrender.com";
    // Si quisieras que funcione en local autom√°ticamente, podr√≠as detectar el host:
    // const isLocal = location.hostname === 'localhost' || location.hostname === '127.0.0.1';
    // const API_BASE = isLocal ? "http://localhost:3002" : "https://perfumeriaclemenss.onrender.com";
  </script>

  <script>
  (function () {
    const form = document.getElementById('registerForm');
    const msg = document.getElementById('registerMsg');

    function showMsg(text, ok=false) {
      msg.style.display = 'block';
      msg.className = ok ? 'alert alert-success' : 'alert alert-danger';
      msg.textContent = text;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Validaci√≥n Bootstrap simple
      let valid = true;
      ['name','email','password'].forEach(id => {
        const el = document.getElementById(id);
        if (!el.checkValidity()) { el.classList.add('is-invalid'); valid = false; }
        else { el.classList.remove('is-invalid'); }
      });
      if (!valid) { return; }

      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      showMsg('Enviando‚Ä¶', true);

      try {
        const resp = await fetch(`${API_BASE}/api/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, email, password })
        });

        const data = await resp.json().catch(()=> ({}));

        if (!resp.ok) {
          // 409 = email ya registrado, 400/500 otros
          showMsg(data.error || `Error al registrar (HTTP ${resp.status})`, false);
          return;
        }

        showMsg(`¬°Cuenta creada! Bienvenido, ${data.user.name}`, true);
        form.reset();
        // Redirigir al login si quieres:
        // setTimeout(() => location.href = 'login.html', 800);
      } catch (err) {
        console.error(err);
        showMsg('Error de red o CORS. Revisa la consola del navegador.', false);
      }
    });
  })();
  </script>

  <!-- ‚ö†Ô∏è Quita este include si el archivo tambi√©n maneja el submit (para evitar doble env√≠o) -->
  <!-- <script src="js/register.js" defer></script> -->
</body>
</html>
